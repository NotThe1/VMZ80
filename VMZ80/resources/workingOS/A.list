0001: 0100         ; A.Z80
0002: 0100         ; 8
0003: 0100             BDOS       EQU    00005H
0004: 0100             OPEN_FILE  EQU    0FH
0005: 0100             CLOSE_FILE EQU    10H
0006: 0100             FIND_FIRST EQU    11H
0007: 0100             FIND_NEXT  EQU    12H
0008: 0100             READ_SEQ   EQU    14H
0009: 0100             SET_DMA    EQU    1Ah
0010: 0100             defaultBuffer EQU    080H
0011: 0100
0012: 0100             TPA        EQU    0100H
0013: 0100
0014: 0100                        ORG    TPA
0015: 0100             Start:
0016: 0100 31 DF 02               LD     SP,Stack
0017: 0103
0018: 0103 11 80 00               LD     DE,defaultBuffer
0019: 0106 0E 1A                  LD     C,SET_DMA
0020: 0108 CD 05 00               CALL   BDOS
0021: 010B 00                     NOP
0022: 010C 0E 11                  LD     C,FIND_FIRST
0023: 010E 11 46 01               LD     DE,FCB
0024: 0111 CD 05 00               CALL   BDOS
0025: 0114
0026: 0114 21 80 00               LD     HL,defaultBuffer
0027: 0117 87                     ADD    A,A                  ; Return Code * 2
0028: 0118 87                     ADD    A,A                  ; Return Code * 4
0029: 0119 87                     ADD    A,A                  ; Return Code * 8
0030: 011A 87                     ADD    A,A                  ; Return Code * 16
0031: 011B 87                     ADD    A,A                  ; Return Code * 32
0032: 011C 5F                     LD     E,A
0033: 011D 16 00                  LD     D,0
0034: 011F 19                     ADD    HL,DE                ; point at dir entry
0035: 0120 11 5F 01               LD     DE,FCB1              ; point at FCB
0036: 0123 01 20 00               LD     BC,32                ; load count
0037: 0126 ED B0                  LDIR                        ; Move to FCB1
0038: 0128             read:
0039: 0128 11 80 00               LD     DE,defaultBuffer
0040: 012B 0E 1A                  LD     C,SET_DMA
0041: 012D CD 05 00               CALL   BDOS
0042: 0130
0043: 0130 11 80 00               LD     DE,defaultBuffer
0044: 0133 0E 14                  LD     C,READ_SEQ
0045: 0135 CD 05 00               CALL   BDOS
0046: 0138 00                     NOP
0047: 0139 3C                     INC    A
0048: 013A 20 EC                  JR     NZ,read
0049: 013C
0050: 013C
0051: 013C
0052: 013C
0053: 013C 76                     HALT
0054: 013D 0E 10                  LD     C,CLOSE_FILE
0055: 013F 11 46 01               LD     DE,FCB
0056: 0142 CD 05 00               CALL   BDOS
0057: 0145 76                     HALT
0058: 0146
0059: 0146
0060: 0146             FCB:
0061: 0146 00                     DB     00
0062: 0147 53 44 31 20 20 20 20 20                DB     'SD1     '
0063: 014F 41 53 4D                DB     'ASM'
0064: 0152 00 00                  DW     0000H
0065: 0154 00 00                  DW     0000H
0066: 0156 00 00                  DW     0000H
0067: 0158 00 00                  DW     0000H
0068: 015A 00 00                  DW     0000H
0069: 015C 00 00                  DW     0000H
0070: 015E 10                     DB     10H
0071: 015F             FCB1:
0072: 015F
0073: 015F         ;DOLLARInclude ./HeaderForA.Z80
0074: 015F                        DS     0100H
0075: 025F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0076: 026F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0077: 027F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0078: 028F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0079: 029F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0080: 02AF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0081: 02BF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0082: 02CF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                DB     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0083: 02DF             Stack:
           ************************   Xref   ************************
0000: $               02CF
0003: BDOS            0005   0020 0024 0041 0045 0056
0005: CLOSE_FILE      0010   0054
0010: defaultBuffer   0080   0018 0026 0039 0043
0060: FCB             0146   0023 0055
0071: FCB1            015F   0035
0006: FIND_FIRST      0011   0022
0007: FIND_NEXT       0012
0004: OPEN_FILE       000F
0038: read            0128   0048
0008: READ_SEQ        0014   0044
0009: SET_DMA         001A   0019 0040
0083: Stack           02DF   0016
0015: Start           0100
0012: TPA             0100   0014
