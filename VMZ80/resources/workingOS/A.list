0001: 0100         ; A.Z80
0002: 0100         ;
0003: 0100
0004: 0100         ;	2018-11-30
0005: 0100         ; 5
0006: 0100             BDOS       EQU    05H
0007: 0100             TRUE       EQU    0FFH
0008: 0100             FALSE      EQU    000H
0009: 0100             CR         EQU    00AH
0010: 0100             LF         EQU    00DH
0011: 0100             TPA        EQU    0100H
0012: 0100             BS         EQU    08H
0013: 0100             SPACE      EQU    020H
0014: 0100             GetRO      EQU    01DH
0015: 0100             SetRO      EQU    01CH
0016: 0100             SelectDisk EQU    0EH
0017: 0100
0018: 0100             BLOCK      EQU    02AH
0019: 0100
0020: 0100
0021: 0100                        ORG    TPA
0022: 0100             Start:
0023: 0100
0024: 0100 21 2A 00               LD     HL,BLOCK             ; Block number
0025: 0103 7D                     LD     A,L                  ; LSB of Block
0026: 0104 E6 07                  AND    0111B                ; Get Mod(Block,8)
0027: 0106 F5                     PUSH   AF                   ; Save the Obit
0028: 0107 06 03                  LD     B,3                  ; divide by 8
0029: 0109 CD 29 01               CALL   ShiftRightHLbyB      ; HL has the Octet
0030: 010C ED 5B 1A 01               LD     DE,(addMap)          ; Start of Map
0031: 0110 19                     ADD    HL,DE                ; Address of target Octet
0032: 0111 F1                     POP    AF
0033: 0112
0034: 0112 47                     LD     B,A                  ; OctetBit now in B
0035: 0113 CD 1C 01               CALL   SetObit              ; Set the bit in place
0036: 0116
0037: 0116
0038: 0116 00                     NOP
0039: 0117 C3 00 01               JP     Start
0040: 011A         ;---------------------------------------
0041: 011A         ;			LD		SP,TPA
0042: 011A         ;			LD		A,(Value)
0043: 011A         ;			LD		HL,Value
0044: 011A         ;			LD		B,3
0045: 011A         ;			CALL	SetObit
0046: 011A         ;			LD		A,(Value)
0047: 011A         ;			NOP
0048: 011A         ;			JR		Start
0049: 011A         ;
0050: 011A         ;
0051: 011A         ;;---------------------------------------
0052: 011A
0053: 011A 00 10       addMap:    DW     Map
0054: 011C
0055: 011C             SetObit:
0056: 011C 04                     INC    B
0057: 011D C5                     PUSH   BC
0058: 011E             Right:
0059: 011E CB 1E                  RR     (HL)
0060: 0120 10 FC                  DJNZ   Right
0061: 0122 C1                     POP    BC
0062: 0123 37                     SCF
0063: 0124             Left:
0064: 0124 CB 16                  RL     (HL)
0065: 0126 10 FC                  DJNZ   Left
0066: 0128 C9                     RET
0067: 0129
0068: 0129         ; HL = Value to be shifted Right                                           ;
0069: 0129         ;  B = Amount to shift                                                     ;
0070: 0129             ShiftRightHLbyB:                      ;
0071: 0129 AF                     XOR    A                    ; else Clear Carry flag            ;
0072: 012A CB 1C                  RR     H                    ; Shift thru CY                    ;
0073: 012C CB 1D                  RR     L                    ; ditto                            ;
0074: 012E 10 F9                  DJNZ   ShiftRightHLbyB      ;
0075: 0130 C9                     RET
0076: 0131         ;
0077: 0131
0078: 0131                        ORG    1000H
0079: 1000             Map:
0080: 1000
           ************************   Xref   ************************
0000: $               1000
0053: addMap          011A   0030
0006: BDOS            0005
0018: BLOCK           002A   0024
0012: BS              0008
0009: CR              000A
0008: FALSE           0000
0014: GetRO           001D
0063: Left            0124   0065
0010: LF              000D
0079: Map             1000   0053
0058: Right           011E   0060
0016: SelectDisk      000E
0055: SetObit         011C   0035
0015: SetRO           001C
0070: ShiftRightHLbyB 0129   0029 0074
0013: SPACE           0020
0022: Start           0100   0039
0011: TPA             0100   0021
0007: TRUE            00FF
